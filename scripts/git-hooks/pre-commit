#!/bin/bash
#
# Pre-commit hook for Sprout project
# This hook runs before every commit to ensure code quality
#
# To install this hook, run: ./scripts/install-git-hooks.sh
#

set -e

echo "ðŸ” Running pre-commit checks..."

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Function to print colored output
print_error() {
    echo -e "${RED}âŒ $1${NC}"
}

print_success() {
    echo -e "${GREEN}âœ… $1${NC}"
}

print_info() {
    echo -e "${YELLOW}â„¹ï¸  $1${NC}"
}

# Check if deno is installed
if ! command -v deno &> /dev/null; then
    print_error "Deno is not installed. Please install Deno from https://deno.land/"
    exit 1
fi

# 1. Format code
print_info "Formatting code with deno fmt..."
if deno fmt; then
    print_success "Code formatting passed"
else
    print_error "Code formatting failed"
    exit 1
fi

# 2. Lint code
print_info "Linting code with deno lint..."
if deno lint; then
    print_success "Linting passed"
else
    print_error "Linting failed"
    exit 1
fi

# 3. Type check
print_info "Type checking with deno check..."
if deno check src/main.ts; then
    print_success "Type checking passed"
else
    print_error "Type checking failed"
    exit 1
fi

# 4. Run tests
print_info "Running tests with deno test..."
if deno test --allow-all; then
    print_success "Tests passed"
else
    print_error "Tests failed"
    exit 1
fi

# Add any formatted files to the commit
git add -u

print_success "All pre-commit checks passed! ðŸŽ‰"
echo ""
